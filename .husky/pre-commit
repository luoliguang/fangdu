#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# æ£€æŸ¥å‰ç«¯ä»£ç 
echo "ğŸ“¦ Checking frontend code..."
cd frontend

# è¿è¡ŒESLintæ£€æŸ¥
echo "ğŸ”§ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint check failed. Please fix the issues before committing."
  exit 1
fi

# è¿è¡ŒPrettieræ ¼å¼åŒ–æ£€æŸ¥
echo "ğŸ’… Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting check failed. Running auto-format..."
  npm run format
  echo "âœ… Code formatted. Please review and commit again."
  exit 1
fi

cd ..

# æ£€æŸ¥åç«¯ä»£ç 
echo "ğŸš€ Checking backend code..."
cd backend

# è¿è¡ŒESLintæ£€æŸ¥
echo "ğŸ”§ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Backend ESLint check failed. Please fix the issues before committing."
  exit 1
fi

# è¿è¡ŒPrettieræ ¼å¼åŒ–æ£€æŸ¥
echo "ğŸ’… Checking code formatting..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Backend code formatting check failed. Running auto-format..."
  npm run format
  echo "âœ… Code formatted. Please review and commit again."
  exit 1
fi

cd ..

echo "âœ… All pre-commit checks passed!"